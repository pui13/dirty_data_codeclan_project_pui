---
title: "Halloween Candy Analysis"
output:
  html_document:
    df_print: paged
---

# Introduction

The dataset used for the analysis below came from three annual datasets (2015,
2016, 2017). The three raw datasets were all cleaned then combined to enable analysys
to be carried out. Below are some assumptions made whilst cleaning :

1. Only included ages between 4-90 in the age column, made the rest NA's.
2. Removed any items which I deemed were not candies
3. Removed the coloured M&Ms as this was a hidden proxy question, as stated on the website containing the datasets.
4. A lot of renaming was done for the countries to account for misspellings and 'creative' country naming. For example:
    * Canada - "soviet canuckistan" and "canae"
    * United States - "cascadia" and state names
    * UK - all the different countries that make up the UK and "god's country"

Things I could have done with more time when cleaning to improve results :

* Rescued some NA countries in the 2017 dataset by checking if there is an input in the state/region column
* Rescued some NA ages by checking if they've been entered in the country column 



##### Load in packages and data
```{r message=FALSE}
library(tidyverse)
library(here)

candy_data <- read_csv(here("clean_data/clean_all_candy.csv"))
glimpse(candy_data)
```


# Analysis

#### What is the total number of candy ratings given across the three years.
(Number of candy ratings, not the number of raters. Donâ€™t count missing values)

```{r}
sum(!is.na(candy_data$rating))
```


#### What was the average age of people who are going out trick or treating?

```{r}
candy_data%>%
  filter(going_trick_or_treating == "Yes") %>%
  summarise(avg_age = mean(age, na.rm = TRUE))
  
```

#### What was the average age of people who are not going trick or treating?

```{r}
candy_data%>%
  filter(going_trick_or_treating == "No") %>%
  summarise(avg_age = mean(age, na.rm = TRUE))
```

#### For each of joy, despair and meh, which candy bar received the most of these ratings?

```{r, message=FALSE}
candy_data %>%
  filter( !is.na(rating))%>%
  group_by(rating, candy)%>%
  summarise(count = n()) %>%
  slice_max(count) 

```

#### How many people rated Starburst as despair?

```{r}
candy_data %>%
  filter(candy == "starburst" & rating == "despair")%>%
  summarise(starburst_despair_ratings = n())
```

#### *For the next three questions, count despair as -1, joy as +1, and meh as 0.*

*Made a new table and only kept the joy and despair ratings (meh = 0 so
not needed in calculations). Changed "joy" to "1" and "despair" to "-1"*

```{r}
rating_keep <- c("joy", "despair")

candy_rating_filtered <- candy_data%>%
  filter(rating %in% rating_keep)%>%
  mutate(rating = if_else(rating == "joy", 1, -1))

```

*For the answers below, I included the top two most popular for each category, as
full sized candy bar was the most popular for every category.*

#### What was the most popular candy bar by this rating system for each gender in the dataset ?

```{r, message=FALSE}
gender_filter <- c("Male", "Female", "Other")

candy_rating_filtered  %>%
  filter( gender %in% gender_filter)%>%
  group_by(gender, candy)%>%
  summarise(points = sum(rating))%>%
  slice_max(points, n=2)
```

#### What was the most popular candy bar in each year?

```{r, message=FALSE}
candy_rating_filtered%>%
  group_by(year, candy)%>%
  summarise(points = sum(rating))%>%
  slice_max(points, n=2)

```

#### What was the most popular candy bar by this rating for people in US, Canada, UK, and all other countries?

```{r, message=FALSE}
candy_rating_filtered%>%
  group_by(country, candy)%>%
  summarise(points = sum(rating))%>%
  slice_max(points, n=2)
```

